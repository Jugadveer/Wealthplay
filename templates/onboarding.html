
{% load static %}

{% block title %}Personalize Your Journey - WealthPlay{% endblock %}

{% block extra_css %}
<style>
    .onboarding-container {
        max-width: 600px;
        margin: 60px auto;
        padding: 40px;
        background: white;
        border-radius: 16px;
        box-shadow: 0 4px 20px rgba(0,0,0,0.1);
    }

    .onboarding-header {
        display: flex;
        align-items: center;
        gap: 12px;
        margin-bottom: 30px;
    }

    .onboarding-header h1 {
        font-size: 28px;
        font-weight: 700;
        color: #333;
        margin: 0;
    }

    .onboarding-icon {
        width: 32px;
        height: 32px;
        color: #14B8A6;
    }

    .progress-bar-container {
        margin-bottom: 40px;
    }

    .progress-label {
        font-size: 14px;
        color: #666;
        margin-bottom: 8px;
        font-weight: 500;
    }

    .progress-bar {
        width: 100%;
        height: 8px;
        background: #f0f0f0;
        border-radius: 4px;
        overflow: hidden;
        display: flex;
    }

    .progress-filled {
        height: 100%;
        background: linear-gradient(90deg, #14B8A6 0%, #EA580C 100%);
        transition: width 0.3s ease;
        border-radius: 4px;
    }

    .question-container {
        margin-bottom: 40px;
    }

    .question-title {
        font-size: 24px;
        font-weight: 700;
        color: #1a1a1a;
        margin-bottom: 30px;
    }

    .option-card {
        display: flex;
        align-items: center;
        gap: 15px;
        padding: 18px 20px;
        margin-bottom: 12px;
        border: 2px solid #e0e0e0;
        border-radius: 12px;
        cursor: pointer;
        transition: all 0.3s;
        background: white;
    }

    .option-card:hover {
        border-color: #14B8A6;
        background: #f0fdfa;
        transform: translateY(-2px);
        box-shadow: 0 4px 12px rgba(20,184,166,0.15);
    }

    .option-card.selected {
        border-color: #14B8A6;
        background: #ecfdf5;
        box-shadow: 0 0 0 3px rgba(20,184,166,0.1);
    }

    .option-radio {
        width: 24px;
        height: 24px;
        border: 2px solid #ccc;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        flex-shrink: 0;
        transition: all 0.3s;
    }

    .option-card.selected .option-radio {
        border-color: #14B8A6;
        background: #14B8A6;
    }

    .option-radio-inner {
        width: 10px;
        height: 10px;
        border-radius: 50%;
        background: white;
        opacity: 0;
        transition: opacity 0.3s;
    }

    .option-card.selected .option-radio-inner {
        opacity: 1;
    }

    .option-icon {
        width: 32px;
        height: 32px;
        display: flex;
        align-items: center;
        justify-content: center;
        flex-shrink: 0;
        font-size: 20px;
    }

    .option-text {
        flex: 1;
        font-size: 16px;
        font-weight: 500;
        color: #333;
    }

    .nav-buttons {
        display: flex;
        gap: 15px;
        justify-content: space-between;
        margin-top: 40px;
    }

    .btn-nav {
        padding: 14px 32px;
        border-radius: 10px;
        font-size: 16px;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.3s;
        border: none;
        font-family: 'Inter', sans-serif;
    }

    .btn-back {
        background: white;
        color: #666;
        border: 2px solid #e0e0e0;
    }

    .btn-back:hover {
        background: #f5f5f5;
        border-color: #ccc;
    }

    .btn-next {
        background: linear-gradient(135deg, #14B8A6 0%, #EA580C 100%);
        color: white;
        flex: 1;
        max-width: 200px;
        margin-left: auto;
    }

    .btn-next:hover {
        transform: translateY(-2px);
        box-shadow: 0 6px 20px rgba(20,184,166,0.3);
    }

    .btn-next:disabled {
        opacity: 0.5;
        cursor: not-allowed;
        transform: none;
    }

    .question-hidden {
        display: none;
    }
</style>
{% endblock %}

{% block content %}
<div class="onboarding-container">
    <div class="onboarding-header">
        <svg class="onboarding-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.374 3.374 0 0014 18.469V19a2 2 0 11-4 0v-.531c0-.895-.356-1.754-.988-2.386l-.548-.547z"></path>
        </svg>
        <h1>Let's personalize your journey</h1>
    </div>

    <div class="progress-bar-container">
        <div class="progress-label">Question <span id="current-question">1</span> of 5</div>
        <div class="progress-bar">
            <div class="progress-filled" id="progress-bar" style="width: 20%;"></div>
        </div>
    </div>

    <form id="onboarding-form">
        <!-- Question 1: Financial Goal -->
        <div class="question-container" id="question-1">
            <div class="question-title">What's your main financial goal?</div>
            <div class="option-card" data-value="long_term_wealth">
                <div class="option-radio"><div class="option-radio-inner"></div></div>
                <div class="option-icon">üå±</div>
                <div class="option-text">Build long-term wealth</div>
            </div>
            <div class="option-card" data-value="specific_goals">
                <div class="option-radio"><div class="option-radio-inner"></div></div>
                <div class="option-icon">üéØ</div>
                <div class="option-text">Save for specific goals</div>
            </div>
            <div class="option-card" data-value="learning">
                <div class="option-radio"><div class="option-radio-inner"></div></div>
                <div class="option-icon">üìö</div>
                <div class="option-text">Just learning for now</div>
            </div>
            <div class="option-card" data-value="extra_income">
                <div class="option-radio"><div class="option-radio-inner"></div></div>
                <div class="option-icon">üí∞</div>
                <div class="option-text">Generate extra income</div>
            </div>
        </div>

        <!-- Question 2: Investment Experience -->
        <div class="question-container question-hidden" id="question-2">
            <div class="question-title">How familiar are you with investing?</div>
            <div class="option-card" data-value="beginner">
                <div class="option-radio"><div class="option-radio-inner"></div></div>
                <div class="option-icon">‚≠ê</div>
                <div class="option-text">Complete beginner</div>
            </div>
            <div class="option-card" data-value="basics">
                <div class="option-radio"><div class="option-radio-inner"></div></div>
                <div class="option-icon">üìñ</div>
                <div class="option-text">Know the basics</div>
            </div>
            <div class="option-card" data-value="experienced">
                <div class="option-radio"><div class="option-radio-inner"></div></div>
                <div class="option-icon">üí°</div>
                <div class="option-text">Fairly experienced</div>
            </div>
            <div class="option-card" data-value="very_experienced">
                <div class="option-radio"><div class="option-radio-inner"></div></div>
                <div class="option-icon">üèÜ</div>
                <div class="option-text">Very experienced</div>
            </div>
        </div>

        <!-- Question 3: Risk Comfort -->
        <div class="question-container question-hidden" id="question-3">
            <div class="question-title">What's your risk comfort level?</div>
            <div class="option-card" data-value="safe">
                <div class="option-radio"><div class="option-radio-inner"></div></div>
                <div class="option-icon">üõ°Ô∏è</div>
                <div class="option-text">Play it safe</div>
            </div>
            <div class="option-card" data-value="balanced">
                <div class="option-radio"><div class="option-radio-inner"></div></div>
                <div class="option-icon">‚öñÔ∏è</div>
                <div class="option-text">Balanced approach</div>
            </div>
            <div class="option-card" data-value="aggressive">
                <div class="option-radio"><div class="option-radio-inner"></div></div>
                <div class="option-icon">üöÄ</div>
                <div class="option-text">Higher returns, higher risk</div>
            </div>
        </div>

        <!-- Question 4: Initial Investment -->
        <div class="question-container question-hidden" id="question-4">
            <div class="question-title">How much would you invest initially (hypothetically)?</div>
            <div class="option-card" data-value="under_10k">
                <div class="option-radio"><div class="option-radio-inner"></div></div>
                <div class="option-icon">üèõÔ∏è</div>
                <div class="option-text">Under ‚Çπ10,000</div>
            </div>
            <div class="option-card" data-value="10k_50k">
                <div class="option-radio"><div class="option-radio-inner"></div></div>
                <div class="option-icon">üíµ</div>
                <div class="option-text">‚Çπ10,000 - ‚Çπ50,000</div>
            </div>
            <div class="option-card" data-value="50k_2l">
                <div class="option-radio"><div class="option-radio-inner"></div></div>
                <div class="option-icon">üíé</div>
                <div class="option-text">‚Çπ50,000 - ‚Çπ2,00,000</div>
            </div>
            <div class="option-card" data-value="over_2l">
                <div class="option-radio"><div class="option-radio-inner"></div></div>
                <div class="option-icon">üëë</div>
                <div class="option-text">Over ‚Çπ2,00,000</div>
            </div>
        </div>

        <!-- Question 5: Investment Timeline -->
        <div class="question-container question-hidden" id="question-5">
            <div class="question-title">What's your investment timeline?</div>
            <div class="option-card" data-value="less_than_1">
                <div class="option-radio"><div class="option-radio-inner"></div></div>
                <div class="option-icon">‚ö°</div>
                <div class="option-text">Less than 1 year</div>
            </div>
            <div class="option-card" data-value="1_to_5">
                <div class="option-radio"><div class="option-radio-inner"></div></div>
                <div class="option-icon">‚òÄÔ∏è</div>
                <div class="option-text">1-5 years</div>
            </div>
            <div class="option-card" data-value="5_plus">
                <div class="option-radio"><div class="option-radio-inner"></div></div>
                <div class="option-icon">üå≥</div>
                <div class="option-text">5+ years</div>
            </div>
        </div>

        <input type="hidden" name="financial_goal" id="financial_goal">
        <input type="hidden" name="investment_experience" id="investment_experience">
        <input type="hidden" name="risk_comfort" id="risk_comfort">
        <input type="hidden" name="initial_investment" id="initial_investment">
        <input type="hidden" name="investment_timeline" id="investment_timeline">
        {% csrf_token %}
    </form>

    <div class="nav-buttons">
        <button type="button" class="btn-nav btn-back" id="back-btn" onclick="previousQuestion()" style="display: none;">Back</button>
        <button type="button" class="btn-nav btn-next" id="next-btn" onclick="nextQuestion()" disabled>Next</button>
    </div>
</div>

<script>
let currentQ = 1;
const totalQuestions = 5;
const answers = {};

function updateProgress() {
    const progress = (currentQ / totalQuestions) * 100;
    document.getElementById('progress-bar').style.width = progress + '%';
    document.getElementById('current-question').textContent = currentQ;
    
    // Show/hide back button
    document.getElementById('back-btn').style.display = currentQ > 1 ? 'block' : 'none';
    
    // Update next button text
    const nextBtn = document.getElementById('next-btn');
    if (currentQ === totalQuestions) {
        nextBtn.textContent = 'Get Started üöÄ';
    } else {
        nextBtn.textContent = 'Next';
    }
}

function showQuestion(qNum) {
    // Hide all questions
    for (let i = 1; i <= totalQuestions; i++) {
        document.getElementById(`question-${i}`).classList.add('question-hidden');
    }
    // Show current question
    document.getElementById(`question-${qNum}`).classList.remove('question-hidden');
    updateProgress();
    
    // Check if current question is answered
    checkAnswer();
}

function checkAnswer() {
    const questionId = `question-${currentQ}`;
    const question = document.getElementById(questionId);
    const selected = question.querySelector('.option-card.selected');
    const nextBtn = document.getElementById('next-btn');
    nextBtn.disabled = !selected;
}

function selectOption(card) {
    // Remove selection from siblings
    const question = card.closest('.question-container');
    question.querySelectorAll('.option-card').forEach(c => c.classList.remove('selected'));
    
    // Select current card
    card.classList.add('selected');
    
    // Save answer
    const value = card.getAttribute('data-value');
    const questionNum = currentQ;
    
    if (questionNum === 1) {
        answers.financial_goal = value;
        document.getElementById('financial_goal').value = value;
    } else if (questionNum === 2) {
        answers.investment_experience = value;
        document.getElementById('investment_experience').value = value;
    } else if (questionNum === 3) {
        answers.risk_comfort = value;
        document.getElementById('risk_comfort').value = value;
    } else if (questionNum === 4) {
        answers.initial_investment = value;
        document.getElementById('initial_investment').value = value;
    } else if (questionNum === 5) {
        answers.investment_timeline = value;
        document.getElementById('investment_timeline').value = value;
    }
    
    checkAnswer();
}

function nextQuestion() {
    if (currentQ < totalQuestions) {
        currentQ++;
        showQuestion(currentQ);
    } else {
        // Submit form
        submitOnboarding();
    }
}

function previousQuestion() {
    if (currentQ > 1) {
        currentQ--;
        showQuestion(currentQ);
        
        // Restore previous selection if exists
        const questionId = `question-${currentQ}`;
        const question = document.getElementById(questionId);
        let savedValue = '';
        
        if (currentQ === 1) savedValue = answers.financial_goal;
        else if (currentQ === 2) savedValue = answers.investment_experience;
        else if (currentQ === 3) savedValue = answers.risk_comfort;
        else if (currentQ === 4) savedValue = answers.initial_investment;
        else if (currentQ === 5) savedValue = answers.investment_timeline;
        
        if (savedValue) {
            const card = question.querySelector(`[data-value="${savedValue}"]`);
            if (card) {
                card.classList.add('selected');
            }
        }
    }
}

async function submitOnboarding() {
    const form = document.getElementById('onboarding-form');
    const formData = new FormData(form);
    
    try {
        const response = await fetch('/api/users/onboarding/', {
            method: 'POST',
            body: formData,
            headers: {
                'X-CSRFToken': document.querySelector('[name=csrfmiddlewaretoken]').value
            }
        });
        
        if (response.ok) {
            const data = await response.json();
            // Store onboarding data in session/localStorage
            sessionStorage.setItem('onboarding_completed', 'true');
            sessionStorage.setItem('user_level', data.level || 'beginner');
            // Redirect to signup/login
            window.location.href = '/';
        } else {
            alert('Error saving onboarding data. Please try again.');
        }
    } catch (error) {
        console.error('Error:', error);
        alert('An error occurred. Please try again.');
    }
}

// Attach click handlers to all option cards
document.addEventListener('DOMContentLoaded', function() {
    document.querySelectorAll('.option-card').forEach(card => {
        card.addEventListener('click', function() {
            selectOption(this);
        });
    });
    
    showQuestion(1);
});
</script>
{% endblock %}

